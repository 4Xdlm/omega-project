# NCR-H2-001: LLM Provider Mode Not Activated via CLI

**Status**: OPEN
**Severity**: MEDIUM
**Phase**: H2-GOLDEN
**Date**: 2026-02-10

## Issue

The `omega-runner` CLI command does not properly activate LLM provider mode when `OMEGA_PROVIDER_MODE=llm` is set as an environment variable.

### Evidence

1. **Environment variable confirmed set**:
   ```bash
   echo $OMEGA_PROVIDER_MODE  # Returns: llm
   echo $ANTHROPIC_API_KEY | head -c 10  # Returns: sk-ant-api
   ```

2. **CLI exits with success but uses mock mode**:
   - Exit code: 0
   - Run ID: 69b752ce50eaedac (deterministic, same as pure mock runs)
   - No cache directory created (OMEGA_CACHE_DIR not used)
   - Verdict: FAIL with all-zero metrics (typical mock behavior)

3. **Code verification**:
   - `packages/genesis-planner/src/providers/factory.ts:25-27` — DOES check `process.env.OMEGA_PROVIDER_MODE`
   - `packages/genesis-planner/src/planner.ts:119,140,169` — DOES use structured prompts from SH2
   - `packages/omega-runner/src/orchestrator/runFull.ts:36` — Calls `runCreation` with default configs
   - Provider instantiation might occur before env var check OR config doesn't pass provider mode

4. **Alternative script works**:
   - `golden/run_golden_llm.ts` successfully calls Claude API
   - Creates cache entries
   - But uses OLD prompts (simple JSON.stringify), not SH2 structured prompts

## Root Cause Hypothesis

The `omega-runner` CLI creates default configs that don't respect `OMEGA_PROVIDER_MODE` env var, OR the provider is instantiated with a hard-coded 'mock' mode somewhere in the config chain between runner → creation-pipeline → genesis-planner.

## Impact on H2-GOLDEN

**GOAL**: Validate that SH2 structured prompts improve Q.1 scores from 8.4/10 to 9.5+/10 using real LLM.

**BLOCKED**: Cannot execute full golden run with:
- NEW SH2 structured prompts (from prompt-builder.ts)
- Real Claude API calls
- Via omega-runner CLI

## Options

### Option A: Fix Provider Configuration (REQUIRES CODE CHANGE)
**Blocked by**: Sprint SH2 is SEALED — no code modifications allowed per CLAUDE.md

### Option B: Hybrid Approach (FEASIBLE NOW)
1. Manually call LLM with SH2 prompts → populate cache
2. Run omega-runner with `OMEGA_PROVIDER_MODE=cache` → deterministic replay
3. Score the results against Q-B baseline

**Steps**:
1. Extract the exact prompts generated by `buildArcPrompt/buildScenePrompt/buildBeatPrompt`
2. Call Claude API manually with those prompts
3. Save responses in the expected cache format
4. Replay with cache mode

### Option C: Defer to Post-SH2 Phase (DOCUMENT ONLY)
Document the gap and recommend fixing in a future sprint dedicated to CLI provider integration.

## Recommendation

**Proceed with Option B** for H2-GOLDEN validation:
- Demonstrates SH2 prompt effectiveness
- Uses real LLM responses
- Maintains SEALED sprint integrity
- Provides valid comparison data

**Document Option A** as a future enhancement (Phase H3 or infrastructure sprint).

## Decision Required

- [ ] Francky approval to proceed with Option B
- [ ] OR: Francky lifts SEALED restriction to fix provider config
- [ ] OR: Defer H2-GOLDEN to post-SH2 phase

---

**Opened by**: Claude Code (IA Principal)
**Requires**: Francky (Architect) decision
